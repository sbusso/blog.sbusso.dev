<div class="heading-wrapper h2"><h2 id="81-install-necessary-services-for-authentication">8.1. Install necessary services for authentication</h2><a class="anchor" href="#81-install-necessary-services-for-authentication" aria-labelledby="81-install-necessary-services-for-authentication"><span hidden>#</span></a></div><pre><code>apt-get install sasl2-bin libsasl2-2 -y
</code></pre><div class="heading-wrapper h2"><h2 id="82-correct-the-permission-of-smtp-authentication-related-files">8.2. Correct the permission of smtp authentication related files,</h2><a class="anchor" href="#82-correct-the-permission-of-smtp-authentication-related-files" aria-labelledby="82-correct-the-permission-of-smtp-authentication-related-files"><span hidden>#</span></a></div><pre><code>chown postfix:sasl /var/run/saslauthd
chown postfix:sasl /etc/sasldb2
adduser postfix sasl
/etc/init.d/postfix restart
</code></pre><div class="heading-wrapper h2"><h2 id="83-create-configuration-files-for-smtp-authentication">8.3. Create configuration files for SMTP authentication</h2><a class="anchor" href="#83-create-configuration-files-for-smtp-authentication" aria-labelledby="83-create-configuration-files-for-smtp-authentication"><span hidden>#</span></a></div><pre><code>cat &gt; /etc/default/saslauthd &lt;&lt;EOF
START=yes
DESC=&quot;SASL Authentication Daemon&quot;
NAME=&quot;saslauthd&quot;
MECHANISMS=&quot;sasldb&quot;
MECH_OPTIONS=&quot;&quot;
THREADS=5
OPTIONS=&quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;
EOF

cat &gt; /etc/postfix/sasl/smtpd.conf &lt;&lt;EOF
pwcheck_method: saslauthd
auxprop_plugin: sasldb
saslauthd_path: /var/run/saslauthd/mux
mech_list: PLAIN LOGIN CRAM-MD5 DIGEST-MD5
EOF
</code></pre><div class="heading-wrapper h2"><h2 id="84-configure-postfix-to-use-sasldb-for-smtp-authentication">8.4. Configure postfix to use sasldb for SMTP authentication,</h2><a class="anchor" href="#84-configure-postfix-to-use-sasldb-for-smtp-authentication" aria-labelledby="84-configure-postfix-to-use-sasldb-for-smtp-authentication"><span hidden>#</span></a></div><pre><code>postconf -e &quot;smtpd_sasl_local_domain=pronostic-facile.fr&quot;
postconf -e &quot;smtpd_sasl_auth_enable=yes&quot;
postconf -e &quot;smtpd_sasl_path=smtpd&quot;
postconf -e &quot;smtpd_sasl_tls_security_options= noanonymous, noplaintext&quot;
postconf -e &quot;broken_sasl_auth_clients=yes&quot;

/etc/init.d/saslauthd restart
/etc/init.d/postfix restart
</code></pre><div class="heading-wrapper h2"><h2 id="85-create-email-user">8.5. Create email user</h2><a class="anchor" href="#85-create-email-user" aria-labelledby="85-create-email-user"><span hidden>#</span></a></div><pre><code>saslpasswd2 -c -u pronostic-facile.fr -f /etc/sasldb2 contact

Password: 6523uu3FuWooM22
</code></pre><div class="heading-wrapper h2"><h2 id="86-testing">8.6. Testing</h2><a class="anchor" href="#86-testing" aria-labelledby="86-testing"><span hidden>#</span></a></div><p>Create password hash</p><pre><code>perl -MMIME::Base64 -e 'print encode_base64(&quot;\000contact\@pronostic-facile.fr\0006523uu3FuWooM22&quot;);'dXNlcjEAdXNlcjEAWmRFeG1ocGRiclBsbw==
</code></pre><p>Send test email</p><pre><code>telnet 0 25

Trying 0.0.0.0...
Connected to 0.
Escape character is '^]'.
220 pronostic-facile.fr ESMTP Postfix (Ubuntu)

EHLO pronostic-facile.fr

250-pronostic-facile.fr
250-PIPELINING
250-SIZE 10240000
250-VRFY
250-ETRN
250-STARTTLS
250-AUTH PLAIN LOGIN CRAM-MD5 DIGEST-MD5
250-AUTH=PLAIN LOGIN CRAM-MD5 DIGEST-MD5
250-ENHANCEDSTATUSCODES
250-8BITMIME
250 DSN
AUTH PLAIN AGNvbnRhY3RAcHJvbm9zdGljLWZhY2lsZS5mcgA2NTIzdXUzRnVXb29NMjI=
235 2.7.0 Authentication successful
MAIL FROM: contact@pronostic-facile.fr
250 2.1.0 Ok
RCPT TO: rnldpj@gmail.com
250 2.1.5 Ok
DATA
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
Subject: Testing EMAIL
This is a testing. Plz ignore.
.
250 2.0.0 Ok: queued as CDC8A4095F
421 4.4.2 pronostic-facile.fr Error: timeout exceeded
Connection closed by foreign host.
</code></pre>